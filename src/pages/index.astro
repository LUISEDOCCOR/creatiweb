---
import Layout from '../layouts/Layout.astro';
import Input from '../components/Input.astro'
import InputSubmit from '../components/InputSubmit.astro'
import Alert from '../components/Alert.astro'
import { v4 as uuidv4 } from 'uuid';
import { db, Pages } from 'astro:db';

if(Astro.request.method == "POST"){
	const formData = await Astro.request.formData()
	const id = uuidv4()
	const username = formData.get("username")
	const password = formData.get("password")
	if(
		typeof username == "string" &&
		typeof password == "string"
	){
		await db.insert(Pages).values({
			id,
			username,
			password
		})
		return Astro.redirect("/pepe")
	}
}
---

<Layout title="Welcome to Astro." header="Create your page ðŸ¤©">
	<main class="flex flex-col items-center">
		<Alert id="alert"/>
		<form method="POST"class="space-y-6">
			<Input 
				id="username" 
				name="username" 
				label="Username ðŸŽ‰"
				border="#FF00AA"
			/>
			<Input 
				id="password" 
				name="password" 
				label="Password ðŸ¤·"
				border="#AA00FF"
				type="password"
			/>
			<div class="w-96 flex justify-end">
				<InputSubmit
				value="Create Page  ðŸš€"	
				id="button-submit"
				/>
			</div>
		<form/>
	</main>
</Layout>
<script>
	const username = document.querySelector("#username") as HTMLInputElement
	const password = document.querySelector("#password") as HTMLInputElement
	const domAlert = document.querySelector("#alert") as HTMLDivElement
	document.querySelector("#button-submit").addEventListener("click", (e)=>{
		if(username.value == "" || password.value == ""){
			e.preventDefault()
			domAlert.classList.remove("hidden")
			domAlert.innerHTML = "Fill in all the fields ðŸ¤£"
			setTimeout(()=>{
				domAlert.classList.add("hidden")
			}, 1500)
		}
	})
</script>

